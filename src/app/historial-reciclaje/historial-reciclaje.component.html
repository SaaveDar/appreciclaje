<div class="historial-container">
  <h2 *ngIf="usuarioActual">Historial de Reciclaje</h2>

<!-- Botón solo si hay usuario y permiso activo -->
<button *ngIf="usuarioActual && permisoReciclaje" (click)="mostrarFormulario = true">
  ➕ Agregar nuevo registro
</button>

<!-- Lista historial solo si hay usuario -->
<div *ngIf="usuarioActual && historial.length > 0; else noHistorial">
  <ul>
    <li *ngFor="let item of historial">
      {{ item.categoria }} - {{ item.residuo }} - {{ item.peso_kg }} kg
    </li>
  </ul>
</div>

<ng-template #noHistorial>
  <p *ngIf="usuarioActual">No hay registros aún.</p>
  <p *ngIf="!usuarioActual">Debes iniciar sesión para ver tu historial.</p>
</ng-template>

<!-- Modal -->
<div class="modal" [class.show]="mostrarFormulario">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Añadir nuevo registro de reciclaje</h5>
        <button type="button" class="close" (click)="mostrarFormulario = false">×</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="enviarRegistro()">
          <div class="form-group">
            <label for="categoria">Categoria</label>
            <select id="categoria" [(ngModel)]="nuevoRegistro.categoria" name="categoria" required>
              <option value="papel">Papel</option>
              <option value="metales">Metales</option>
              <option value="plastico">Plástico</option>
              <option value="vidrio">Vidrio</option>
              <option value="electronico">Electrónicos</option>
            </select>
          </div>
          <div class="form-group">
            <label for="residuo">Residuo</label>
            <input type="text" id="residuo" [(ngModel)]="nuevoRegistro.residuo" name="residuo" required>
          </div>
          <div class="form-group">
            <label for="peso">Peso (kg)</label>
            <input type="number" id="peso" [(ngModel)]="nuevoRegistro.peso_kg" name="peso" required min="0.01" step="0.01">
          </div>
          <div class="form-group">
            <label for="foto">Foto</label>
            <input type="file" id="foto" (change)="onFileSelected($event)" required>
          </div>
          <button type="submit">Registrar</button>
        </form>
      </div>
    </div>
  </div>
</div>

</div>