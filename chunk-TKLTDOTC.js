import{k as U,l as q,o as A,r as L,x as _}from"./chunk-G7DVZCEU.js";import{$a as T,D as p,Eb as u,Fb as I,Na as S,O as R,Q as w,Ra as s,S as O,V as m,Wa as h,Wb as V,_ as f,eb as x,fa as P,ga as E,lb as a,nb as M,pb as r,qb as o,rb as D,s as j,ub as $,va as k,yb as B,zb as g}from"./chunk-VPYR7OMU.js";var c=function(t){return t[t.State=0]="State",t[t.Transition=1]="Transition",t[t.Sequence=2]="Sequence",t[t.Group=3]="Group",t[t.Animate=4]="Animate",t[t.Keyframes=5]="Keyframes",t[t.Style=6]="Style",t[t.Trigger=7]="Trigger",t[t.Reference=8]="Reference",t[t.AnimateChild=9]="AnimateChild",t[t.AnimateRef=10]="AnimateRef",t[t.Query=11]="Query",t[t.Stagger=12]="Stagger",t}(c||{});function F(t,e){return{type:c.Trigger,name:t,definitions:e,options:{}}}function y(t,e=null){return{type:c.Animate,styles:e,timings:t}}function l(t){return{type:c.Style,styles:t,offset:null}}function v(t,e,i=null){return{type:c.Transition,expr:t,animation:e,options:i}}var b=class t{constructor(e){this.http=e}apiUrl="https://comunidadvmapps.com/api.php?consulta=tipos-residuos";tiposResiduosCache=null;tiposResiduos$=null;obtenerTipos(){return this.tiposResiduosCache?j(this.tiposResiduosCache):this.tiposResiduos$?this.tiposResiduos$:(this.tiposResiduos$=this.http.get(this.apiUrl).pipe(O(e=>{this.tiposResiduosCache=e,this.tiposResiduos$=null}),R(1)),this.tiposResiduos$)}static \u0275fac=function(i){return new(i||t)(f(_))};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})};var C=class t{constructor(e){this.http=e}apiUrl="https://www.comunidadvmapps.com/api.php?consulta=tipos-residuos";escucharCambiosTiposResiduos(){return p(5e3).pipe(w(()=>this.http.get(this.apiUrl)))}static \u0275fac=function(i){return new(i||t)(f(_))};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})};function K(t,e){t&1&&(r(0,"div",3),u(1," Cargando categor\xEDas... "),o())}function Q(t,e){if(t&1){let i=$();r(0,"div",6)(1,"div",7),B("click",function(){let d=P(i).$implicit,Y=g(2);return E(Y.voltear(d.id))}),r(2,"div",8)(3,"div",9),D(4,"img",10),r(5,"div",11)(6,"h3"),u(7),o(),r(8,"p"),u(9),o()()()(),r(10,"div",12)(11,"div",13),D(12,"img",14),o()()()()}if(t&2){let i=e.$implicit,n=g(2);s(),M("volteado",n.tarjetasVolteadas[i.id]),s(3),a("src","assets/icon/"+i.icono_url+".png",S),s(3),I(i.nombre),s(2),I(i.descripcion),s(3),a("src","assets"+n.getImagenActual(i),S)("@slideIn",n.imagenIndex[i.id])}}function J(t,e){if(t&1&&(r(0,"div",4),x(1,Q,13,7,"div",5),o()),t&2){let i=g();s(),a("ngForOf",i.tiposResiduos)("ngForTrackBy",i.trackById)}}var z=class t{constructor(e,i,n,d){this.tiposService=e;this.socketService=i;this.cdr=n;this.platformId=d;this.isBrowser=L(d)}tiposResiduos=[];tarjetasVolteadas={};imagenIndex={};carruseles={};cambiosSocket$;cargando=!0;isBrowser;ngOnInit(){this.isBrowser?(this.cargarDatosIniciales(),this.cambiosSocket$=this.socketService.escucharCambiosTiposResiduos().subscribe(e=>{this.tiposResiduos=e,e.forEach(i=>{this.imagenIndex[i.id]??=0,this.tarjetasVolteadas[i.id]??=!1}),this.cdr.detectChanges()})):this.cargando=!1}cargarDatosIniciales(){this.cargando=!0,this.tiposService.obtenerTipos().subscribe(e=>{if(this.tiposResiduos=e,e.forEach(i=>{this.imagenIndex[i.id]??=0,this.tarjetasVolteadas[i.id]??=!1}),this.isBrowser&&"performance"in window){let i=performance.now();console.log(`\u23F1 Carga completada en: ${i.toFixed(2)} ms`)}this.cargando=!1,this.cdr.detectChanges()})}trackById(e,i){return i.id}ngOnDestroy(){this.cancelarTodosCarruseles(),this.cambiosSocket$?.unsubscribe()}voltear(e){Object.keys(this.tarjetasVolteadas).forEach(i=>{let n=parseInt(i);n!==e&&(this.tarjetasVolteadas[n]=!1,this.cancelarCarrusel(n))}),this.tarjetasVolteadas[e]=!this.tarjetasVolteadas[e],this.cdr.detectChanges(),this.tarjetasVolteadas[e]?this.iniciarCarrusel(e):this.cancelarCarrusel(e)}obtenerImagenes(e){return[e.images1,e.images2,e.images3,e.images4,e.images5].filter(i=>!!i)}getImagenActual(e){let i=this.obtenerImagenes(e),n=this.imagenIndex[e.id]%i.length;return i[n]||""}iniciarCarrusel(e){!this.isBrowser||this.carruseles[e]||(this.carruseles[e]=p(4e3).subscribe(()=>{let i=this.tiposResiduos.find(d=>d.id===e);if(!i)return;let n=this.obtenerImagenes(i).length;this.imagenIndex[e]=(this.imagenIndex[e]+1)%n,this.cdr.detectChanges()}))}cancelarCarrusel(e){this.carruseles[e]&&(this.carruseles[e].unsubscribe(),delete this.carruseles[e])}cancelarTodosCarruseles(){Object.values(this.carruseles).forEach(e=>e.unsubscribe()),this.carruseles={}}static \u0275fac=function(i){return new(i||t)(h(b),h(C),h(V),h(k))};static \u0275cmp=T({type:t,selectors:[["app-categorias"]],decls:4,vars:2,consts:[[1,"titulo"],["class","mensaje-carga",4,"ngIf"],["class","contenedor-categorias",4,"ngIf"],[1,"mensaje-carga"],[1,"contenedor-categorias"],["class","tarjeta-wrapper",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tarjeta-wrapper"],[1,"tarjeta-flip",3,"click"],[1,"tarjeta-categoria","tarjeta-front"],[1,"contenido-interno"],[1,"icono-categoria",3,"src"],[1,"contenido-texto"],[1,"tarjeta-categoria","tarjeta-back"],[1,"carrusel-container"],["loading","lazy",1,"imagen-carousel","slide-animation",3,"src"]],template:function(i,n){i&1&&(r(0,"h2",0),u(1,"\u267B\uFE0F Categor\xEDas de Residuos"),o(),x(2,K,2,0,"div",1)(3,J,2,2,"div",2)),i&2&&(s(2),a("ngIf",n.cargando),s(),a("ngIf",!n.cargando))},dependencies:[A,U,q],styles:["[_nghost-%COMP%]{display:block;padding:2rem;background-color:#f4f7f6;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.titulo[_ngcontent-%COMP%]{text-align:left;font-size:2.5rem;color:#2d6a4f;margin-bottom:1.5rem}.contenedor-categorias[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:3rem 4rem;justify-content:flex-start}.tarjeta-categoria[_ngcontent-%COMP%]{background-color:#fff;border-radius:16px;padding:2rem;width:300px;box-shadow:0 6px 16px #0000001a;transition:transform .3s ease,box-shadow .3s ease}.icono-categoria[_ngcontent-%COMP%]{width:150px;height:150px;object-fit:contain;flex-shrink:0;margin:0;transition:transform .3s ease-in-out}.icono-categoria[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.contenido-interno[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;text-align:left}.contenido-texto[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.3rem;color:#2d6a4f}.contenido-texto[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:#555}.tarjeta-wrapper[_ngcontent-%COMP%]{perspective:1000px;width:350px;height:220px;margin-bottom:2rem;flex:0 0 auto;position:relative}.tarjeta-flip[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .6s;min-height:100%;backface-visibility:hidden;-webkit-backface-visibility:hidden;will-change:transform}.tarjeta-flip.volteado[_ngcontent-%COMP%]{transform:rotateY(180deg)}.tarjeta-front[_ngcontent-%COMP%], .tarjeta-back[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:12px;overflow:hidden;padding:1rem;box-sizing:border-box;top:0;left:0}.tarjeta-front[_ngcontent-%COMP%]{background-color:#fff}.tarjeta-back[_ngcontent-%COMP%]{transform:rotateY(180deg);background-color:#f0f0f0;display:flex;align-items:center;justify-content:center}.imagen-carousel[_ngcontent-%COMP%]{width:90%;height:90%;object-fit:cover;border-radius:8px;will-change:transform,opacity}.carrusel-container[_ngcontent-%COMP%]{width:100%;height:100%;overflow:hidden;display:flex;align-items:center;justify-content:center}"],data:{animation:[F("slideIn",[v(":increment",[l({opacity:0,transform:"translateX(100%)"}),y("400ms ease-out",l({opacity:1,transform:"translateX(0)"}))]),v(":decrement",[l({opacity:0,transform:"translateX(-100%)"}),y("400ms ease-out",l({opacity:1,transform:"translateX(0)"}))])])]},changeDetection:0})};export{z as CategoriasComponent};
