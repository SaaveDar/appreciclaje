import{c as R,d as v,f as d,g as b}from"./chunk-C5P3YSZX.js";import{$a as A,Ac as H,Bb as l,C as p,Cb as w,Ma as x,N as S,P as T,R as M,Sa as r,U as u,Vb as F,Wa as s,Z as g,ea as k,eb as I,fa as P,jc as V,kc as U,lb as c,nb as E,nc as N,pb as o,qb as a,qc as z,r as O,rb as j,ua as D,ub as $,vb as B,wb as f,wc as h}from"./chunk-WRU36DLG.js";var _=class i{constructor(e){this.http=e}apiUrl="https://comunidadvmapps.com/api.php?consulta=tipos-residuos";tiposResiduosCache=null;tiposResiduos$=null;obtenerTipos(){return this.tiposResiduosCache?O(this.tiposResiduosCache):this.tiposResiduos$?this.tiposResiduos$:(this.tiposResiduos$=this.http.get(this.apiUrl).pipe(M(e=>{this.tiposResiduosCache=e,this.tiposResiduos$=null}),S(1)),this.tiposResiduos$)}static \u0275fac=function(t){return new(t||i)(g(h))};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};var y=class i{constructor(e){this.http=e}apiUrl="https://www.comunidadvmapps.com/api.php?consulta=tipos-residuos";escucharCambiosTiposResiduos(){return p(5e3).pipe(T(()=>this.http.get(this.apiUrl)))}static \u0275fac=function(t){return new(t||i)(g(h))};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};function J(i,e){i&1&&(o(0,"div",3),l(1," Cargando categor\xEDas... "),a())}function K(i,e){if(i&1){let t=$();o(0,"div",6)(1,"div",7),B("click",function(){let m=k(t).$implicit,C=f(2);return P(C.voltear(m.id))}),o(2,"div",8)(3,"div",9),j(4,"img",10),o(5,"div",11)(6,"h3"),l(7),a(),o(8,"p"),l(9),a()()()(),o(10,"div",12)(11,"div",13),j(12,"img",14),a()()()()}if(i&2){let t=e.$implicit,n=f(2);r(),E("volteado",n.tarjetasVolteadas[t.id]),r(3),c("src","assets/icon/"+t.icono_url+".png",x),r(3),w(t.nombre),r(2),w(t.descripcion),r(3),c("src","assets"+n.getImagenActual(t),x)("@slideIn",n.imagenIndex[t.id])}}function Q(i,e){if(i&1&&(o(0,"div",4),I(1,K,13,7,"div",5),a()),i&2){let t=f();r(),c("ngForOf",t.tiposResiduos)("ngForTrackBy",t.trackById)}}var L=class i{constructor(e,t,n,m,C){this.tiposService=e;this.socketService=t;this.cdr=n;this.sessionService=m;this.platformId=C;this.isBrowser=z(C)}tiposResiduos=[];tarjetasVolteadas={};imagenIndex={};carruseles={};cambiosSocket$;cargando=!0;isBrowser;ngOnInit(){this.isBrowser?(this.cargarDatosIniciales(),this.cambiosSocket$=this.socketService.escucharCambiosTiposResiduos().subscribe(e=>{this.tiposResiduos=e,e.forEach(t=>{this.imagenIndex[t.id]??=0,this.tarjetasVolteadas[t.id]??=!1}),this.cdr.detectChanges()})):this.cargando=!1}cargarDatosIniciales(){this.cargando=!0,this.tiposService.obtenerTipos().subscribe(e=>{if(this.tiposResiduos=e,e.forEach(t=>{this.imagenIndex[t.id]??=0,this.tarjetasVolteadas[t.id]??=!1}),this.isBrowser&&"performance"in window){let t=performance.now();console.log(`\u23F1 Carga completada en: ${t.toFixed(2)} ms`)}this.cargando=!1,this.cdr.detectChanges()})}trackById(e,t){return t.id}ngOnDestroy(){this.cancelarTodosCarruseles(),this.cambiosSocket$?.unsubscribe()}voltear(e){Object.keys(this.tarjetasVolteadas).forEach(t=>{let n=parseInt(t);n!==e&&(this.tarjetasVolteadas[n]=!1,this.cancelarCarrusel(n))}),this.tarjetasVolteadas[e]=!this.tarjetasVolteadas[e],this.cdr.detectChanges(),this.tarjetasVolteadas[e]?this.iniciarCarrusel(e):this.cancelarCarrusel(e)}obtenerImagenes(e){return[e.images1,e.images2,e.images3,e.images4,e.images5].filter(t=>!!t)}getImagenActual(e){let t=this.obtenerImagenes(e),n=this.imagenIndex[e.id]%t.length;return t[n]||""}iniciarCarrusel(e){!this.isBrowser||this.carruseles[e]||(this.carruseles[e]=p(4e3).subscribe(()=>{let t=this.tiposResiduos.find(m=>m.id===e);if(!t)return;let n=this.obtenerImagenes(t).length;this.imagenIndex[e]=(this.imagenIndex[e]+1)%n,this.cdr.detectChanges()}))}cancelarCarrusel(e){this.carruseles[e]&&(this.carruseles[e].unsubscribe(),delete this.carruseles[e])}cancelarTodosCarruseles(){Object.values(this.carruseles).forEach(e=>e.unsubscribe()),this.carruseles={}}static \u0275fac=function(t){return new(t||i)(s(_),s(y),s(F),s(H),s(D))};static \u0275cmp=A({type:i,selectors:[["app-categorias"]],decls:4,vars:2,consts:[[1,"titulo"],["class","mensaje-carga",4,"ngIf"],["class","contenedor-categorias",4,"ngIf"],[1,"mensaje-carga"],[1,"contenedor-categorias"],["class","tarjeta-wrapper",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tarjeta-wrapper"],[1,"tarjeta-flip",3,"click"],[1,"tarjeta-categoria","tarjeta-front"],[1,"contenido-interno"],[1,"icono-categoria",3,"src"],[1,"contenido-texto"],[1,"tarjeta-categoria","tarjeta-back"],[1,"carrusel-container"],["loading","lazy",1,"imagen-carousel","slide-animation",3,"src"]],template:function(t,n){t&1&&(o(0,"h2",0),l(1,"\u267B\uFE0F Categor\xEDas de Residuos"),a(),I(2,J,2,0,"div",1)(3,Q,2,2,"div",2)),t&2&&(r(2),c("ngIf",n.cargando),r(),c("ngIf",!n.cargando))},dependencies:[N,V,U],styles:["[_nghost-%COMP%]{display:block;padding:2rem;background-color:#f4f7f6;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.titulo[_ngcontent-%COMP%]{text-align:left;font-size:2.5rem;color:#2d6a4f;margin-bottom:1.5rem}.contenedor-categorias[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:3rem 4rem;justify-content:flex-start}.tarjeta-categoria[_ngcontent-%COMP%]{background-color:#fff;border-radius:16px;padding:2rem;width:300px;box-shadow:0 6px 16px #0000001a;transition:transform .3s ease,box-shadow .3s ease}.icono-categoria[_ngcontent-%COMP%]{width:150px;height:150px;object-fit:contain;flex-shrink:0;margin:0;transition:transform .3s ease-in-out}.icono-categoria[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.contenido-interno[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;text-align:left}.contenido-texto[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.3rem;color:#2d6a4f}.contenido-texto[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:#555}.tarjeta-wrapper[_ngcontent-%COMP%]{perspective:1000px;width:350px;height:220px;margin-bottom:2rem;flex:0 0 auto;position:relative}.tarjeta-flip[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .6s;min-height:100%;backface-visibility:hidden;-webkit-backface-visibility:hidden;will-change:transform}.tarjeta-flip.volteado[_ngcontent-%COMP%]{transform:rotateY(180deg)}.tarjeta-front[_ngcontent-%COMP%], .tarjeta-back[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:12px;overflow:hidden;padding:1rem;box-sizing:border-box;top:0;left:0}.tarjeta-front[_ngcontent-%COMP%]{background-color:#fff}.tarjeta-back[_ngcontent-%COMP%]{transform:rotateY(180deg);background-color:#f0f0f0;display:flex;align-items:center;justify-content:center}.imagen-carousel[_ngcontent-%COMP%]{width:90%;height:90%;object-fit:cover;border-radius:8px;will-change:transform,opacity}.carrusel-container[_ngcontent-%COMP%]{width:100%;height:100%;overflow:hidden;display:flex;align-items:center;justify-content:center}"],data:{animation:[R("slideIn",[b(":increment",[d({opacity:0,transform:"translateX(100%)"}),v("400ms ease-out",d({opacity:1,transform:"translateX(0)"}))]),b(":decrement",[d({opacity:0,transform:"translateX(-100%)"}),v("400ms ease-out",d({opacity:1,transform:"translateX(0)"}))])])]},changeDetection:0})};export{L as CategoriasComponent};
